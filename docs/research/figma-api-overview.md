# Figma API 調査レポート

## 概要

Figma APIは、デザインツールFigmaのデータとプログラマティックにやり取りするための3つの主要なAPIを提供しています。各APIは異なる用途と機能を持ち、開発者のニーズに応じて選択できます。

## Figma APIの種類

### 1. REST API

外部システムとの統合やデータ読み取りに特化したAPI。

**特徴:**

- 読み取り専用アクセス
- ユーザーの操作なしで独立して動作可能
- 複数ファイルへの同時アクセス可能（チームキーが必要）
- ファイルメタデータ、権限、コメント、バージョン履歴へのアクセス

**主なエンドポイント:**

| エンドポイント | 説明 |
|--------------|------|
| `GET /v1/files/:file_key` | ファイルのJSONツリーを取得 |
| `GET /v1/files/:file_key/nodes` | 特定ファイルのノード構造を取得 |
| `GET /v1/files/:file_key/components` | ファイル内のコンポーネント情報を取得 |
| `GET /v1/files/:file_key/component_sets` | コンポーネントセットと最終更新時刻を取得 |
| `GET /v1/images/:file_key` | ファイルから画像をエクスポート（SVG/PNG） |
| `GET /v1/files/:file_key/comments` | ファイルのすべてのコメントを取得 |
| `POST /v1/files/:file_key/comments` | コメントを作成 |
| `GET /v1/files/:file_key/versions` | ファイルのバージョン履歴を取得（最新25件） |

**認証方法:**

- Personal Access Token（個人アクセストークン）
- OAuth Token（OAuthトークン）

**レート制限:**

- クレジットベースシステムを採用
- 1分あたり6,000クレジット、1日あたり1,200,000クレジット
- エンドポイント別のクレジット消費量：
  - ファイルアクセス: 50クレジット/ファイル（1分あたり120ファイルまで）
  - 画像レンダリング: 1分あたり30画像まで
- レスポンスタイム制限: 55秒（GETファイル、GET画像エンドポイント）
- 制限超過時: HTTPステータス429を返す

### 2. Plugin API

Figmaエディタ内でファイルコンテンツの読み書きが可能なAPI。

**特徴:**

- ファイルへの読み書きアクセス
- ユーザーの操作が必要（バックグラウンド動作不可）
- iframeで実行され、ブラウザAPIへのフルアクセス可能
- ネットワークリクエスト、ローカルファイル、Canvas、WebGL、WebAssemblyをサポート
- figmaグローバルオブジェクトを通じてアクセス

**主な機能:**

- レイヤーパネル内のコンテンツ操作
- ノードベースの階層構造（各レイヤーがノードに対応）
- プロパティの読み取りと変更
- VSCodeなどのエディタでの型補完サポート（タイピングファイル提供）

**ノードタイプ:**

- 汎用プロパティ（すべてのノード）
- 共有プロパティ（複数のノードタイプ）
- 固有プロパティ（特定のノードタイプ）

### 3. Widget API

Figmaデザインファイルやh FigJamボード内で実行される永続的でインタラクティブなオブジェクトを作成するAPI。

**特徴:**

- すべてのユーザーが同じウィジェットを表示・操作可能
- 複数のウィジェットを同時実行可能
- Plugin APIと組み合わせて使用（figma.widget経由）
- コンポーネントベースのアーキテクチャ

**主要コンポーネント:**

- **Input**: テキストコンポーネントを編集可能にする
- **Fragment**: 親ノードなしで子要素をレンダリング
- **Span**: Textコンポーネント内のテキスト範囲をスタイリング

**主要関数とフック:**

- `register`: ウィジェットレンダリングのメインエントリーポイント
- `waitForTask`: データフェッチなどの非同期処理を有効化
- `useWidgetId`: 一意のIDで現在アクティブなウィジェットを参照

## API選択ガイド

| 用途 | 推奨API | 理由 |
|-----|--------|------|
| 外部システムとの統合 | REST API | 独立動作可能、読み取り専用で安全 |
| デザインファイルの自動化 | Plugin API | ファイル編集機能、豊富なノード操作 |
| コラボレーション機能 | Widget API | 複数ユーザー間での共有・同時操作 |
| データ抽出・分析 | REST API | バッチ処理、スケジュール実行可能 |
| インタラクティブツール | Plugin API + Widget API | 高度な機能とUI要素の組み合わせ |

## ベストプラクティス

1. **レート制限への対応**
   - エクスポネンシャルバックオフの実装
   - 429エラーの適切なハンドリング
   - キャッシング戦略の活用

2. **認証の選択**
   - 個人プロジェクト: Personal Access Token
   - マルチユーザーアプリ: OAuth Token

3. **エラーハンドリング**
   - タイムアウト（55秒）を考慮した設計
   - ネットワークエラーのリトライ機構
   - ユーザーへの適切なフィードバック

4. **パフォーマンス最適化**
   - 必要最小限のAPIコール
   - バッチ処理の活用
   - 並列処理の検討（レート制限内で）

## リソース

- **公式ドキュメント**: <https://www.figma.com/developers/api>
- **Plugin APIドキュメント**: <https://www.figma.com/plugin-docs/>
- **Widget APIドキュメント**: <https://www.figma.com/widget-docs/>
- **OpenAPI仕様**: <https://github.com/figma/rest-api-spec>
- **コミュニティフォーラム**: <https://forum.figma.com/c/rest-api/>

## まとめ

Figma APIは、それぞれ異なる強みを持つ3つのAPIを提供することで、開発者の多様なニーズに対応しています。REST APIは外部システムとの連携、Plugin APIはファイル編集の自動化、Widget APIはコラボレーション機能の実装に適しています。適切なAPIを選択し、レート制限やベストプラクティスに従うことで、効果的なFigma統合アプリケーションを構築できます。
